<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="/css/bootstrap.min.css" rel="stylesheet">
  <title>Loading…</title>
  <style>
    .markdown-body { padding: 24px; }
  </style>
</head>
<body>

  <div class="container">
    <nav class="navbar navbar-expand-lg">
      <a href="/index.html" class="navbar-brand">
        <h1>anyun chatterjee</h1>
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link" href="/index.html">home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/teaching.html">teaching</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/cannabis-psa-archive/index.html">cannabis psas</a>
          </li>
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="/blog.html">blog</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/docs/anyun-chatterjee_CV.pdf" target="_blank">cv</a>
          </li>
        </ul>
      </div>
    </nav>
  </div>

  <div class="container markdown-body" id="post-root">
    <p class="text-muted">Loading post…</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    function parseFrontmatter(text) {
      const end = text.startsWith('---') ? text.indexOf('\n---', 3) : -1;
      if (end === -1) return {data: {}, content: text};
      const data = Object.fromEntries(
        text.substring(3, end).trim().split(/\n+/)
          .map(line => line.split(':'))
          .filter(([k]) => k)
          .map(([k, ...v]) => [k.trim(), v.join(':').trim()])
      );
      return {data, content: text.substring(end + 4).trim()};
    }

    (async function() {
      const slug = new URLSearchParams(location.search).get('post');
      const root = document.getElementById('post-root');
      if (!slug) return root.innerHTML = '<p class="text-danger">No post specified. Use ?post=slug</p>';

      try {
        const [idxRes, mdRes] = await Promise.all([
          fetch('/blogs/index.json').catch(() => null),
          fetch(`/blogs/${slug}.md`)
        ]);
        if (!mdRes.ok) throw new Error('Not found');

        const index = idxRes?.ok ? await idxRes.json() : [];
        const {data, content} = parseFrontmatter(await mdRes.text());
        const indexPost = index.find(it => it.slug === slug);
        const title = indexPost?.title || data.title || '';
        const date = indexPost?.date || data.date || '';

        document.title = title ? `${title} — anyun chatterjee` : 'Blog Post — anyun chatterjee';

        const idx = indexPost ? index.indexOf(indexPost) : -1;
        const [prev, next] = idx !== -1 ? [index[idx + 1], index[idx - 1]] : [];
        const nav = idx !== -1 ? `<div class="d-flex justify-content-between mb-3"><div>${prev ? `<a class="btn btn-outline-secondary" href="/post.html?post=${encodeURIComponent(prev.slug)}">&larr; Previous blog</a>` : ''}</div><div><a class="btn btn-outline-secondary" href="/blog.html">Return to list of blogs</a></div><div>${next ? `<a class="btn btn-outline-secondary" href="/post.html?post=${encodeURIComponent(next.slug)}">Next blog &rarr;</a>` : ''}</div></div>` : '';

        root.innerHTML = `${title ? `<h2>${title}</h2>` : ''}${marked.parse(content)}${nav}<footer class="bottom mt-4"><hr><p>my email address is [anyunchatterjee] [at] [gmail] [dot] [com].</p><small><i>${date ? `this blog was published on ${date}` : ''}</i></small></footer>`;
      } catch (err) {
        root.innerHTML = `<p class="text-danger">Failed to load post: ${err.message}</p>`;
      }
    })();
  </script>
  <script src="/js/bootstrap.bundle.min.js"></script>
</body>
</html>